<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global AQI Checker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD3E1D9b-ZqZqYqYqYqYqYqYqYqYqYqYqY&libraries=visualization"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .map-container {
            height: 400px;
            width: 100%;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .aqi-level-0 { background-color: #50f0e6; }
        .aqi-level-1 { background-color: #50ccaa; }
        .aqi-level-2 { background-color: #f0e641; }
        .aqi-level-3 { background-color: #f0a641; }
        .aqi-level-4 { background-color: #f04141; }
        .aqi-level-5 { background-color: #a341f0; }
        .precaution-card {
            transition: all 0.3s ease;
        }
        .precaution-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .search-dropdown {
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold text-blue-800 mb-2">Global AQI Checker</h1>
            <p class="text-gray-600">Check real-time air quality index for cities worldwide</p>
        </header>

        <!-- Search Section -->
        <div class="max-w-2xl mx-auto mb-12 relative">
            <div class="flex shadow-lg rounded-full overflow-hidden">
                <input type="text" id="citySearch" placeholder="Search for a city, state or country..." 
                       class="flex-grow px-6 py-4 focus:outline-none">
                <button id="searchBtn" class="bg-blue-600 text-white px-6 hover:bg-blue-700 transition">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <div id="searchResults" class="search-dropdown absolute z-10 w-full mt-1 bg-white shadow-lg rounded-lg hidden">
                <!-- Search results will appear here -->
            </div>
        </div>

        <!-- Main Dashboard -->
        <div id="dashboard" class="hidden">
            <!-- Current AQI Display -->
            <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                <div class="flex flex-col md:flex-row items-center justify-between">
                    <div class="mb-4 md:mb-0">
                        <h2 class="text-2xl font-semibold" id="currentLocation">New Delhi, India</h2>
                        <p class="text-gray-500" id="currentDate">Updated: June 15, 2023 14:30</p>
                    </div>
                    <div class="flex items-center">
                        <div id="aqiValue" class="text-5xl font-bold mr-4">156</div>
                        <div id="aqiLevel" class="px-4 py-2 rounded-full text-white font-medium">Unhealthy</div>
                    </div>
                </div>
            </div>

            <!-- AQI Chart and Map -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- AQI Chart -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-4">7-Day AQI Trend</h3>
                    <canvas id="aqiChart" height="300"></canvas>
                </div>
                
                <!-- Map -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-4">Nearby Air Quality</h3>
                    <div id="map" class="map-container"></div>
                </div>
            </div>

            <!-- Precautions and Health Advice -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4">Health Precautions</h3>
                <div id="precautions" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Precautions will be dynamically inserted here -->
                </div>
            </div>

            <!-- Awareness Video -->
            <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                <h3 class="text-xl font-semibold mb-4">Air Quality Awareness</h3>
                <div class="aspect-w-16 aspect-h-9">
                    <iframe id="awarenessVideo" class="w-full h-96 rounded-lg" src="https://www.youtube.com/embed/6L5UVm0KA6c" 
                            frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen></iframe>
                </div>
            </div>

            <!-- Nearby Cities AQI -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-xl font-semibold mb-4">Nearby Cities Air Quality</h3>
                <div id="nearbyCities" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- Nearby cities data will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading" class="text-center py-12 hidden">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-600 mb-4"></div>
            <p class="text-gray-600">Fetching air quality data...</p>
        </div>

        <!-- Initial State -->
        <div id="initialState" class="text-center py-20">
            <div class="max-w-md mx-auto">
                <i class="fas fa-cloud-sun text-6xl text-blue-400 mb-4"></i>
                <h3 class="text-2xl font-semibold mb-2">Check Air Quality</h3>
                <p class="text-gray-600 mb-6">Search for any city, state or country to view real-time air quality index and health recommendations.</p>
                <button id="useMyLocation" class="bg-blue-600 text-white px-6 py-3 rounded-full hover:bg-blue-700 transition">
                    <i class="fas fa-location-arrow mr-2"></i> Use My Location
                </button>
            </div>
        </div>
    </div>

    <script>
        // Mock data - in a real app, this would come from an API
        const mockCities = [
            { name: "New Delhi", country: "India", aqi: 156, level: 3, lat: 28.6139, lng: 77.2090 },
            { name: "Mumbai", country: "India", aqi: 112, level: 2, lat: 19.0760, lng: 72.8777 },
            { name: "Beijing", country: "China", aqi: 178, level: 3, lat: 39.9042, lng: 116.4074 },
            { name: "New York", country: "USA", aqi: 42, level: 1, lat: 40.7128, lng: -74.0060 },
            { name: "London", country: "UK", aqi: 38, level: 1, lat: 51.5074, lng: -0.1278 },
            { name: "Tokyo", country: "Japan", aqi: 56, level: 1, lat: 35.6762, lng: 139.6503 },
            { name: "Paris", country: "France", aqi: 48, level: 1, lat: 48.8566, lng: 2.3522 },
            { name: "Los Angeles", country: "USA", aqi: 68, level: 2, lat: 34.0522, lng: -118.2437 },
            { name: "Berlin", country: "Germany", aqi: 34, level: 1, lat: 52.5200, lng: 13.4050 },
            { name: "Singapore", country: "Singapore", aqi: 52, level: 1, lat: 1.3521, lng: 103.8198 }
        ];

        // AQI Levels and colors
        const aqiLevels = [
            { min: 0, max: 50, level: "Good", color: "aqi-level-0", description: "Air quality is satisfactory, and air pollution poses little or no risk." },
            { min: 51, max: 100, level: "Moderate", color: "aqi-level-1", description: "Air quality is acceptable. However, there may be a risk for some people, particularly those who are unusually sensitive to air pollution." },
            { min: 101, max: 150, level: "Unhealthy for Sensitive Groups", color: "aqi-level-2", description: "Members of sensitive groups may experience health effects. The general public is less likely to be affected." },
            { min: 151, max: 200, level: "Unhealthy", color: "aqi-level-3", description: "Some members of the general public may experience health effects; members of sensitive groups may experience more serious health effects." },
            { min: 201, max: 300, level: "Very Unhealthy", color: "aqi-level-4", description: "Health alert: The risk of health effects is increased for everyone." },
            { min: 301, max: 500, level: "Hazardous", color: "aqi-level-5", description: "Health warning of emergency conditions: everyone is more likely to be affected." }
        ];

        // Precautions for each AQI level
        const precautions = [
            {
                level: 0,
                title: "Good Air Quality",
                icon: "smile",
                items: [
                    "Enjoy outdoor activities",
                    "Open windows to ventilate your home",
                    "Great day for outdoor exercise"
                ]
            },
            {
                level: 1,
                title: "Moderate Air Quality",
                icon: "meh",
                items: [
                    "Unusually sensitive people should consider reducing prolonged outdoor exertion",
                    "Keep windows open for ventilation",
                    "Normal outdoor activities are generally safe"
                ]
            },
            {
                level: 2,
                title: "Unhealthy for Sensitive Groups",
                icon: "frown",
                items: [
                    "Sensitive groups should reduce prolonged outdoor exertion",
                    "People with heart or lung disease, older adults, and children should limit outdoor activities",
                    "Consider wearing a mask if sensitive to air pollution"
                ]
            },
            {
                level: 3,
                title: "Unhealthy Air Quality",
                icon: "exclamation-triangle",
                items: [
                    "Everyone may begin to experience health effects",
                    "Sensitive groups should avoid prolonged outdoor exertion",
                    "Consider rescheduling outdoor activities",
                    "Use air purifiers indoors"
                ]
            },
            {
                level: 4,
                title: "Very Unhealthy Air Quality",
                icon: "exclamation-circle",
                items: [
                    "Health alert: everyone may experience more serious health effects",
                    "Avoid all outdoor exertion",
                    "Keep windows and doors closed",
                    "Run air purifiers on high",
                    "Consider wearing N95 masks if going outside is necessary"
                ]
            },
            {
                level: 5,
                title: "Hazardous Air Quality",
                icon: "skull-crossbones",
                items: [
                    "Health warnings of emergency conditions",
                    "Everyone should avoid all outdoor activities",
                    "Stay indoors with windows and doors closed",
                    "Use air purifiers continuously",
                    "Wear N95 masks if you must go outside",
                    "Consider temporarily relocating if possible"
                ]
            }
        ];

        // Awareness videos for different AQI levels
        const awarenessVideos = {
            good: "https://www.youtube.com/embed/6L5UVm0KA6c",
            moderate: "https://www.youtube.com/embed/6L5UVm0KA6c",
            unhealthy: "https://www.youtube.com/embed/e6rglsLy1Ys",
            veryUnhealthy: "https://www.youtube.com/embed/e6rglsLy1Ys",
            hazardous: "https://www.youtube.com/embed/e6rglsLy1Ys"
        };

        // DOM Elements
        const citySearch = document.getElementById('citySearch');
        const searchBtn = document.getElementById('searchBtn');
        const searchResults = document.getElementById('searchResults');
        const dashboard = document.getElementById('dashboard');
        const loading = document.getElementById('loading');
        const initialState = document.getElementById('initialState');
        const useMyLocation = document.getElementById('useMyLocation');
        const currentLocation = document.getElementById('currentLocation');
        const currentDate = document.getElementById('currentDate');
        const aqiValue = document.getElementById('aqiValue');
        const aqiLevel = document.getElementById('aqiLevel');
        const precautionsContainer = document.getElementById('precautions');
        const nearbyCitiesContainer = document.getElementById('nearbyCities');
        const awarenessVideo = document.getElementById('awarenessVideo');

        // Chart and Map variables
        let aqiChart;
        let map;
        let markers = [];

        // Initialize the app
        function init() {
            // Event listeners
            citySearch.addEventListener('input', handleSearchInput);
            searchBtn.addEventListener('click', handleSearch);
            useMyLocation.addEventListener('click', handleUseMyLocation);
            
            // Clicking on a search result
            searchResults.addEventListener('click', (e) => {
                if (e.target.classList.contains('search-result-item')) {
                    const cityName = e.target.getAttribute('data-city');
                    const country = e.target.getAttribute('data-country');
                    const lat = parseFloat(e.target.getAttribute('data-lat'));
                    const lng = parseFloat(e.target.getAttribute('data-lng'));
                    
                    searchResults.classList.add('hidden');
                    citySearch.value = `${cityName}, ${country}`;
                    
                    // Show loading state
                    showLoading();
                    
                    // Simulate API call with timeout
                    setTimeout(() => {
                        updateDashboard(cityName, country, lat, lng);
                    }, 1000);
                }
            });
        }

        // Handle search input
        function handleSearchInput() {
            const query = citySearch.value.trim().toLowerCase();
            
            if (query.length < 2) {
                searchResults.classList.add('hidden');
                return;
            }
            
            // Filter cities based on query
            const results = mockCities.filter(city => 
                city.name.toLowerCase().includes(query) || 
                city.country.toLowerCase().includes(query)
            );
            
            displaySearchResults(results);
        }

        // Display search results
        function displaySearchResults(results) {
            if (results.length === 0) {
                searchResults.innerHTML = '<div class="p-4 text-gray-500">No results found</div>';
                searchResults.classList.remove('hidden');
                return;
            }
            
            let html = '';
            results.forEach(city => {
                html += `
                    <div class="search-result-item p-3 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-0" 
                         data-city="${city.name}" data-country="${city.country}" data-lat="${city.lat}" data-lng="${city.lng}">
                        <div class="font-medium">${city.name}</div>
                        <div class="text-sm text-gray-500">${city.country}</div>
                    </div>
                `;
            });
            
            searchResults.innerHTML = html;
            searchResults.classList.remove('hidden');
        }

        // Handle search button click
        function handleSearch() {
            const query = citySearch.value.trim();
            if (query === '') return;
            
            // For simplicity, just pick the first match
            const results = mockCities.filter(city => 
                city.name.toLowerCase().includes(query.toLowerCase()) || 
                city.country.toLowerCase().includes(query.toLowerCase())
            );
            
            if (results.length > 0) {
                const city = results[0];
                showLoading();
                
                setTimeout(() => {
                    updateDashboard(city.name, city.country, city.lat, city.lng);
                }, 1000);
            }
        }

        // Handle "Use My Location" button
        function handleUseMyLocation() {
            if (navigator.geolocation) {
                showLoading();
                
                navigator.geolocation.getCurrentPosition(
                    position => {
                        // Find nearest city from our mock data
                        const nearestCity = findNearestCity(position.coords.latitude, position.coords.longitude);
                        
                        setTimeout(() => {
                            updateDashboard(nearestCity.name, nearestCity.country, nearestCity.lat, nearestCity.lng);
                        }, 1000);
                    },
                    error => {
                        console.error("Error getting location:", error);
                        hideLoading();
                        alert("Could not get your location. Please try again or search for a city manually.");
                    }
                );
            } else {
                alert("Geolocation is not supported by your browser. Please search for a city manually.");
            }
        }

        // Find nearest city from coordinates
        function findNearestCity(lat, lng) {
            let nearest = mockCities[0];
            let minDistance = calculateDistance(lat, lng, nearest.lat, nearest.lng);
            
            for (let i = 1; i < mockCities.length; i++) {
                const distance = calculateDistance(lat, lng, mockCities[i].lat, mockCities[i].lng);
                if (distance < minDistance) {
                    minDistance = distance;
                    nearest = mockCities[i];
                }
            }
            
            return nearest;
        }

        // Calculate distance between two coordinates (simplified)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Earth radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Show loading state
        function showLoading() {
            initialState.classList.add('hidden');
            dashboard.classList.add('hidden');
            loading.classList.remove('hidden');
        }

        // Hide loading state
        function hideLoading() {
            loading.classList.add('hidden');
        }

        // Update dashboard with city data
        function updateDashboard(cityName, country, lat, lng) {
            // For demo purposes, we'll use mock data
            const cityData = mockCities.find(c => c.name === cityName && c.country === country) || 
                            { name: cityName, country: country, aqi: Math.floor(Math.random() * 300), lat: lat, lng: lng };
            
            // Update basic info
            currentLocation.textContent = `${cityData.name}, ${cityData.country}`;
            currentDate.textContent = `Updated: ${new Date().toLocaleString()}`;
            aqiValue.textContent = cityData.aqi;
            
            // Determine AQI level
            const levelInfo = getAqiLevelInfo(cityData.aqi);
            aqiLevel.textContent = levelInfo.level;
            aqiLevel.className = `px-4 py-2 rounded-full text-white font-medium ${levelInfo.color}`;
            
            // Update chart
            updateChart(cityData);
            
            // Update precautions
            updatePrecautions(levelInfo.levelIndex);
            
            // Update nearby cities
            updateNearbyCities(lat, lng);
            
            // Update map
            updateMap(lat, lng);
            
            // Update awareness video based on AQI level
            updateAwarenessVideo(levelInfo.levelIndex);
            
            // Show dashboard
            hideLoading();
            dashboard.classList.remove('hidden');
        }

        // Get AQI level info
        function getAqiLevelInfo(aqiValue) {
            for (let i = 0; i < aqiLevels.length; i++) {
                if (aqiValue >= aqiLevels[i].min && aqiValue <= aqiLevels[i].max) {
                    return {
                        level: aqiLevels[i].level,
                        color: aqiLevels[i].color,
                        levelIndex: i
                    };
                }
            }
            return {
                level: "Unknown",
                color: "bg-gray-400",
                levelIndex: 0
            };
        }

        // Update chart with AQI data
        function updateChart(cityData) {
            const ctx = document.getElementById('aqiChart').getContext('2d');
            
            // Generate mock historical data for the past 7 days
            const dates = [];
            const aqiValues = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                dates.push(date.toLocaleDateString('en-US', { weekday: 'short' }));
                
                // Generate random AQI values around the current AQI
                const randomAqi = Math.max(0, Math.min(500, 
                    cityData.aqi + Math.floor(Math.random() * 40) - 20
                ));
                aqiValues.push(randomAqi);
            }
            
            // Destroy previous chart if it exists
            if (aqiChart) {
                aqiChart.destroy();
            }
            
            // Create new chart
            aqiChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'AQI',
                        data: aqiValues,
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2,
                        tension: 0.4,
                        pointBackgroundColor: function(context) {
                            const value = context.dataset.data[context.dataIndex];
                            return getAqiLevelInfo(value).color.replace('aqi-level-', '#').slice(0, 7);
                        },
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const levelInfo = getAqiLevelInfo(context.raw);
                                    return `AQI: ${context.raw} (${levelInfo.level})`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 300,
                            title: {
                                display: true,
                                text: 'AQI Value'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        }
                    }
                }
            });
        }

        // Update precautions based on AQI level
        function updatePrecautions(levelIndex) {
            const precautionData = precautions[levelIndex];
            
            let html = `
                <div class="precaution-card bg-white p-6 rounded-lg shadow-md border-l-4 ${aqiLevels[levelIndex].color}">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-${precautionData.icon} text-2xl mr-3 ${aqiLevels[levelIndex].color.replace('aqi-level-', 'text-')}"></i>
                        <h4 class="text-lg font-semibold">${precautionData.title}</h4>
                    </div>
                    <ul class="list-disc pl-5 space-y-2">
                        ${precautionData.items.map(item => `<li>${item}</li>`).join('')}
                    </ul>
                </div>
            `;
            
            // Add general health advice cards
            html += `
                <div class="precaution-card bg-white p-6 rounded-lg shadow-md border-l-4 border-blue-500">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-heartbeat text-2xl mr-3 text-blue-500"></i>
                        <h4 class="text-lg font-semibold">General Health Advice</h4>
                    </div>
                    <ul class="list-disc pl-5 space-y-2">
                        <li>Stay hydrated to help your body cope with pollution</li>
                        <li>Eat foods rich in antioxidants (berries, nuts, green vegetables)</li>
                        <li>Consider using air purifiers in your home</li>
                        <li>Monitor air quality regularly if you have respiratory conditions</li>
                    </ul>
                </div>
                
                <div class="precaution-card bg-white p-6 rounded-lg shadow-md border-l-4 border-green-500">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-home text-2xl mr-3 text-green-500"></i>
                        <h4 class="text-lg font-semibold">Indoor Air Quality Tips</h4>
                    </div>
                    <ul class="list-disc pl-5 space-y-2">
                        <li>Keep windows closed when outdoor air quality is poor</li>
                        <li>Use exhaust fans when cooking</li>
                        <li>Avoid burning candles or incense</li>
                        <li>Clean regularly to reduce dust</li>
                        <li>Consider adding indoor plants that purify air</li>
                    </ul>
                </div>
            `;
            
            precautionsContainer.innerHTML = html;
        }

        // Update nearby cities list
        function updateNearbyCities(lat, lng) {
            // Find cities within 500km radius (for demo, we'll just take 4 closest cities)
            const citiesWithDistance = mockCities.map(city => ({
                ...city,
                distance: calculateDistance(lat, lng, city.lat, city.lng)
            })).filter(city => city.distance > 0); // Exclude the current city
            
            // Sort by distance and take first 4
            const nearby = citiesWithDistance.sort((a, b) => a.distance - b.distance).slice(0, 4);
            
            let html = '';
            nearby.forEach(city => {
                const levelInfo = getAqiLevelInfo(city.aqi);
                
                html += `
                    <div class="bg-white p-4 rounded-lg shadow-sm border-l-4 ${levelInfo.color}">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h4 class="font-medium">${city.name}</h4>
                                <p class="text-sm text-gray-500">${city.country}</p>
                            </div>
                            <span class="font-bold">${city.aqi}</span>
                        </div>
                        <div class="text-sm ${levelInfo.color.replace('aqi-level-', 'text-')}">${levelInfo.level}</div>
                        <div class="text-xs text-gray-500 mt-1">${Math.round(city.distance)} km away</div>
                    </div>
                `;
            });
            
            nearbyCitiesContainer.innerHTML = html;
        }

        // Update map with nearby AQI data
        function updateMap(lat, lng) {
            // Clear previous markers
            markers.forEach(marker => marker.setMap(null));
            markers = [];
            
            // Create map centered on selected city
            const mapOptions = {
                center: new google.maps.LatLng(lat, lng),
                zoom: 8,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                styles: [
                    {
                        "featureType": "poi",
                        "stylers": [
                            { "visibility": "off" }
                        ]
                    }
                ]
            };
            
            map = new google.maps.Map(document.getElementById('map'), mapOptions);
            
            // Add marker for selected city
            const selectedCity = mockCities.find(c => 
                Math.abs(c.lat - lat) < 0.1 && Math.abs(c.lng - lng) < 0.1
            ) || { aqi: Math.floor(Math.random() * 300) };
            
            const levelInfo = getAqiLevelInfo(selectedCity.aqi);
            const markerColor = levelInfo.color.replace('aqi-level-', '').replace('-', '_');
            
            const marker = new google.maps.Marker({
                position: new google.maps.LatLng(lat, lng),
                map: map,
                title: `${selectedCity.name || "Selected Location"}: AQI ${selectedCity.aqi}`,
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    fillColor: getComputedStyle(document.documentElement).getPropertyValue(`--color-${markerColor}`) || '#4285F4',
                    fillOpacity: 1,
                    strokeColor: '#fff',
                    strokeWeight: 1,
                    scale: 10
                }
            });
            
            markers.push(marker);
            
            // Add markers for nearby cities
            mockCities.forEach(city => {
                if (Math.abs(city.lat - lat) < 1 && Math.abs(city.lng - lng) < 1) {
                    const cityLevelInfo = getAqiLevelInfo(city.aqi);
                    const cityMarkerColor = cityLevelInfo.color.replace('aqi-level-', '').replace('-', '_');
                    
                    const cityMarker = new google.maps.Marker({
                        position: new google.maps.LatLng(city.lat, city.lng),
                        map: map,
                        title: `${city.name}: AQI ${city.aqi}`,
                        icon: {
                            path: google.maps.SymbolPath.CIRCLE,
                            fillColor: getComputedStyle(document.documentElement).getPropertyValue(`--color-${cityMarkerColor}`) || '#4285F4',
                            fillOpacity: 1,
                            strokeColor: '#fff',
                            strokeWeight: 1,
                            scale: 8
                        }
                    });
                    
                    markers.push(cityMarker);
                }
            });
            
            // Add AQI legend
            const legend = document.createElement('div');
            legend.className = 'bg-white p-3 shadow-md rounded-lg';
            legend.innerHTML = `
                <div class="font-medium mb-2">AQI Levels</div>
                <div class="flex items-center mb-1">
                    <div class="w-4 h-4 rounded-full bg-[#50f0e6] mr-2"></div>
                    <span>0-50 (Good)</span>
                </div>
                <div class="flex items-center mb-1">
                    <div class="w-4 h-4 rounded-full bg-[#50ccaa] mr-2"></div>
                    <span>51-100 (Moderate)</span>
                </div>
                <div class="flex items-center mb-1">
                    <div class="w-4 h-4 rounded-full bg-[#f0e641] mr-2"></div>
                    <span>101-150 (Unhealthy for SG)</span>
                </div>
                <div class="flex items-center mb-1">
                    <div class="w-4 h-4 rounded-full bg-[#f0a641] mr-2"></div>
                    <span>151-200 (Unhealthy)</span>
                </div>
                <div class="flex items-center mb-1">
                    <div class="w-4 h-4 rounded-full bg-[#f04141] mr-2"></div>
                    <span>201-300 (Very Unhealthy)</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 rounded-full bg-[#a341f0] mr-2"></div>
                    <span>300+ (Hazardous)</span>
                </div>
            `;
            
            map.controls[google.maps.ControlPosition.RIGHT_TOP].push(legend);
        }

        // Update awareness video based on AQI level
        function updateAwarenessVideo(levelIndex) {
            let videoUrl;
            
            if (levelIndex <= 1) {
                videoUrl = awarenessVideos.good;
            } else if (levelIndex <= 2) {
                videoUrl = awarenessVideos.moderate;
            } else if (levelIndex <= 3) {
                videoUrl = awarenessVideos.unhealthy;
            } else if (levelIndex <= 4) {
                videoUrl = awarenessVideos.veryUnhealthy;
            } else {
                videoUrl = awarenessVideos.hazardous;
            }
            
            awarenessVideo.src = videoUrl;
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>